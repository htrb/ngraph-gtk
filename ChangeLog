2009-02-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11commn.c (GraphSave): "overwrite" is FALSE when
	"initfil" is NULL.
	(GraphSave): check overwrite before show save dialog.

	* src/gtk/x11axis.c (SectionDialogSetup, CrossDialogSetup)
	(AxisPosDialogSetup): type of spin buttons for width, height and
	length are "SPIN_BUTTON_TYPE_POSITION".

	* src/oaxis.c (get_axis_group_type, get_axis_box, set_axis_box):
	add.
	(axisbbox): use "get_axis_group_type()", "get_axis_box()" and
	"set_axis_box()".
	(axismatch, axismove, axischange, axiszoom): use
	"get_axis_group_type()".
	(axis_change_point0, axis_change_point1, axis_change_point2)
	(axis_change_point3): add.
	(axischange): use "axis_change_point0()", "axis_change_point1()",
	"axis_change_point2()" and "axis_change_point3()".
	(check_direction): add.
	(axisbbox, axischange): call "check_direction()" to check
	direction of axises.


2009-02-09  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/oaxis.c (axissave, axisbbox, axismatch, axismove)
	(axischange, axiszoom, axisadjust, axisautoscalefile)
	(axisdraw): add initialization to avoid compile warnings.
	(axisautoscalefile): set "set" as TRUE when "set" is FALSE.
	(axisgrouping): check "data[0]".
	(set_group, set_group_pos): add.
	(axisgrouping): use "set_group()".
	(axisgrouppos): use "set_group_pos()".
	(axis_default, axis_default_set, axis_default_set_ref)
	(axis_default_set_adj): add.
	(axisdefgrouping): use "axis_default()", "axis_default_set_adj()"
	and "axis_default_set_ref()".
	(enum AXIS_TYPE, enum AXIS_GAUGE, enum AXIS_NUM_POS)
	(enum AXIS_NUM_ALIGN, enum AXIS_NUM_DIR): add.

	* src/omath.c (mformula): use "mathcode_error()".

	* src/ofit.c (fitput): use "mathcode_error()".

	* src/omath.c (addmath): initialize "MathErrorCodeArray".

	* src/ofit.c (addfit): initialize "MathErrorCodeArray".

	* src/ofile.c (f2dloadconfig2): remove.
	(mathcode_error): remove.
	(addfile): initialize "MathErrorCodeArray".

	* src/mathcode.c (mathcode_error): add.

2009-02-06  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11opt.c (add_prm_str_to_array): add.
	(save_misc_config): use "add_prm_str_to_array()".
	(save_misc_config): save "coordwin_font".
	(DefaultDialogClose): call "add_str_to_array()" when
	"Menulocal.coordwin_font" is NULL.
	(MiscDialogSetupItem): set font name to "d->coordwin_font" if
	"Menulocal.coordwin_font" is not NULL.
	(MiscDialogSetup): create widgets for "Menulocal.coordwin_font".
	(MiscDialogClose): set selected font to "Menulocal.coordwin_font"
	and call "CoordWinSetFont()".

	* src/gtk/x11dialg.h (struct MiscDialog): add member
	"coordwin_font".

	* src/gtk/x11cood.c (CoordWinSetFont): add.
	(CoordWinDrawTex): remove.
	(CoordWinSetCoord): call "gtk_label_set_text()" instead of
	"CoordWinSetCoord()".
	(CoordWinSetCoord): change format strings for "x" and "y" from
	"%.2f" to "%6.2f".
	(CoordWinSetCoord): change format strings for axis id from "%d" to
	"%2d".
	(CoordWinUpdate): call "label_sub_window_create()" instead of
	"text_sub_window_create()".

	* src/gtk/ox11menu.c (MenuConfig): add data for "coordwin_font".
	(menuinit): initialize "Menulocal.coordwin_font".

	* src/gtk/ox11menu.h (struct menulocal): add member
	"coordwin_font".

	* src/gtk/gtk_subwin.c (sub_window_create): add argument
	"with_view_port".
	(sub_window_create): use "gtk_scrolled_window_add_with_viewport()"
	when "with_view_port" is TRUE.
	(label_sub_window_create): add.

	* src/omath.c (mformula): use "switch" to cheack "rcode".

	* src/ofile.c (mathcode_error): add.
	(f2dputmath, fitout): use "mathcode_error()".

	* src/gtk/x11gui.c (DialogExecute): call "gtk_widget_grab_focus()"
	when "data->focus" is not NULL.
	(DialogExecute): call "gtk_widget_show_all()" out side of the
	loop.
	(DialogExecute): check "data->show_buttons "out side of the
	loop.

	* src/gtk/x11lgnd.c (LegendTextDialogSetup): set poniter of the
	widget to "d->focus" instead of call "gtk_widget_grab_focus()".

	* src/gtk/x11graph.c (SaveDialogSetup): 

	* src/gtk/x11file.c (MarkDialogSetup): 

	* src/gtk/x11dialg.c (initdialog): initialize member "focus" of
	each instance of struct.

	* src/gtk/x11dialg.h (struct DialogType): add member "focus" to
	dialog related struct.

2009-02-05  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/oagrid.c (agriddraw): bug fix: fix calculation of coordinate
	when "axdir" or "aydir" is 3.
	(agriddraw): adjust "dirx" and "diry" as these value is greater or
	equal to zero and less than 36000.

	* src/oaxis.c (axisdirection): add.
	(axis): "axisdirection()" is called wheh field "direction" is
	changed.

	* src/odraw.h (enum INTERPOLATION_TYPE): add.

	* src/mathcode.c (mathcode): return value type of "mathcode()" is
	"enum MATH_CODE_ERROR_NO".

	* src/gtk/x11graph.c (DirectoryDialogClose, CmGraphHistory): call
	"ErrorMessage()" when "chdir()" returns non zero value.

	* src/gtk/x11commn.c (ErrorMessage): add.

	* src/gtk/x11file.c (FitDialogSetSensitivity): use "FIT_OBJ_TYPE".
	(enum MATH_FNC_TYPE): add.
	(MathTextDialogSetup, MathTextDialogClose): use "MATH_FNC_TYPE".
	(FitDialogSetSensitivity): use "FIT_OBJ_TYPE".
	(FileDialogFit, FileDialogType, draw_type_pixbuf, select_type)
	(start_editing_type, f2dsettings): use "FILE_OBJ_PLOT_TYPE".

	* src/ofit.c (fitpoly, fitfit): use "FIT_OBJ_TYPE".

	* src/ofit.h: add.

	* src/ofile.c (f2ddraw): do "fp->datanum = f2dlocal->num" after
	call "fitout()" when "redraw" is true.
	(opendata, rectout, errorbarout, stairout, barout, f2ddraw): use
	"FILE_OBJ_PLOT_TYPE".
	(curveout, curveoutfile, f2dsettings): use "INTERPOLATION_TYPE".

	* src/ofile.h (enum FILE_OBJ_PLOT_TYPE): add

2009-02-04  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* driver/Makefile.am (ngp2, dir_defs.h): depend on Makefile.

	* src/gtk/Makefile.am (dir_defs.h): depend on Makefile.

	* src/gtk/ogra2cairo.c (loadfont): remove unused variables "lang"
	and "lang_ja".
	(gra2cairo_get_fontmap_num): add.

	* src/gtk/x11opt.c (save_font_config, save_ext_viewer_config)
	(save_misc_config, save_script_config, save_ext_driver_config)
	(save_viewer_config, save_child_geometory_config)
	(save_geometory_config, add_str_to_array)
	(add_str_with_int_to_array, add_geometry_to_array): add.
	(DefaultDialogClose): use "add_str_to_array()",
	"save_geometory_config()" and so on.
	(scriptlist_sel_cb, drvlist_sel_cb, fontlist_sel_cb): add.
	(PrefScriptDialogSetup, PrefDriverDialogSetup)
	(PrefFontDialogSetup): set signal handler to GtkTreeSelection for
	"changed" signal.
	(get_font_alias): add.
	(set_font_from_font_selection_dialog): use "get_font_alias()".
	(PrefFontDialogAdd): use "get_font_alias()" and
	"gra2cairo_get_fontmap()" to check if "alias" is valid string.

	* src/gtk/x11dialg.h (struct PrefScriptDialog)
	(struct PrefDriverDialog, struct PrefFontDialog): add member
	"update_b" and "del_b".

	* src/gtk/gtk_liststore.c (list_store_set_string)
	(list_store_path_set_string, tree_store_set_string): type of
	argument "v" is "const char *".

2009-02-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11opt.c (DefaultDialogSetup): add "Font aliases"
	button.
	(DefaultDialogClose): add codes for save font map.
	(PrefFontDialogSetupItem, create_font_selection_dialog)
	(set_font_from_font_selection_dialog, PrefFontDialogUpdate)
	(PrefFontDialogRemove, PrefFontDialogAdd, font_list_defailt_cb)
	(PrefFontDialogSetup, PrefFontDialogClose, PrefFontDialog)
	(CmOptionPrefFont): add.
	(CmOptionMenu): add case for "MenuIdOptionPrefFont".

	* src/gtk/x11menu.h (enum MenuID): add "MenuIdOptionPrefFont".

	* src/gtk/x11menu.c (create_preferencemenu): add menu item "Font
	aliases".

	* src/gtk/x11dialg.h (struct PrefFontDialog): add.

	* src/gtk/x11dialg.c: add global variable "DlgPrefFont".

	* src/gtk/ogra2cairo.c (FontFaceStr, gra2cairo_get_fontmap)
	(gra2cairo_remove_fontmap, gra2cairo_add_fontmap, free_fonts)
	(gra2cairo_update_fontmap, check_type): add.
	(init_conf, free_conf): use "free_fonts()".
	(loadconfig): remove unused variable "fcur".
	(init_conf): use "FontFaceStr".

	* src/gtk/ogra2cairo.h (struct gra2cairo_local): remove unused
	member "font_opt".

2009-01-29  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (create_legendx): use "swapint()".

2009-01-28  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* addin/math.nsc: format result with "text::printf".

	* src/gtk/x11view.c (mouse_down_move): don't check
	"arraynum(d->focusobj)".
	(mouse_up_point): remove unused variables "num" and "focused".
	(mouse_up_point): use "switch" instead of "if".
	(mouse_up_drag, mouse_up_zoom, mouse_up_change): don't call
	"SetCursor()".
	(ViewerEvLButtonUp): call "SetCursor()" when "d->Mode" is
	"PointB", "LegendB", "AxisB", "TrimB", "DataB" or "EvalB".
	(get_mouse_cursor_type): return GDK_LEFT_PTR when "num == 0".

	* src/gtk/x11scrip.c (ScriptDialogClose): initialize
	"d->execscript" as NULL before check "d->ret".
	(CmScriptExec): call "delobj(shell, newid)" when "arrayadd()"
	returns NULL.

2009-01-23  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* debian/Makefile.am: add files for debian package.

	* src/gtk/x11menu.c (application): call "gtk_widget_show_all()"
	instead of "gtk_window_present()".

2009-01-20  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (start_editing): treat "id" as oid when
	"name[0] == '^'".

	* src/oagrid.c (agridtight): use "obj_do_tighten()".

	* src/oaxis.c (axistight): use "obj_do_tighten()".

	* src/ofile.c (f2dtight): use "obj_do_tighten()".

	* src/object.c (obj_do_tighten): add.

2009-01-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11merge.c (POPUP_ITEM_TOP, POPUP_ITEM_UP)
	(POPUP_ITEM_DOWN, POPUP_ITEM_BOTTOM): add.
	(MergeWinExpose): change sensitibity of popup menu item.

	* src/gtk/x11lgnd.c (POPUP_ITEM_TOP, POPUP_ITEM_UP)
	(POPUP_ITEM_DOWN, POPUP_ITEM_BOTTOM): add.
	(LegendWinExpose): change sensitibity of popup menu item.

	* src/gtk/x11file.c (POPUP_ITEM_TOP, POPUP_ITEM_UP)
	(POPUP_ITEM_DOWN, POPUP_ITEM_BOTTOM): add.
	(popup_show_cb): change sensitibity of popup menu item.
	(FileDialog): d->multi_open is TRUE when "multi > 0".

	* src/gtk/x11axis.c (POPUP_ITEM_TOP, POPUP_ITEM_UP)
	(POPUP_ITEM_DOWN, POPUP_ITEM_BOTTOM): add.
	(popup_show_cb): change sensitibity of popup menu item.

2009-01-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11dialg.h (struct FitDialog): add members
	"through_box", "dim_box", "weight_box", "usr_deriv_box",
	"usr_def_frame" and "div_box".

	* src/gtk/x11file.c (FitDialogSetSensitivity): add.
	(FitDialogSetup): add signal handler for some widgets to change
	sensitibity of widgets.

2009-01-14  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11dialg.h (struct FileDialog): add member "apply_all"
	and "multi_open".

	* src/gtk/x11merge.c (MergeDialogSetup): add signal handler for
	"copy" button.

	* src/gtk/x11lgnd.c (LegendCurveDialogSetup)
	(LegendPolyDialogSetup, LegendArrowDialogSetup)
	(LegendRectDialogSetup, LegendArcDialogSetup)
	(LegendMarkDialogSetup, LegendTextDialogSetup): add signal handler
	for "copy" and "copy all" button.

	* src/gtk/x11file.c (FitDialogSetup, FileMoveDialogSetup)
	(FileMaskDialogSetup, FileLoadDialogSetup, FileMathDialogSetup)
	(FileDialogSetup): add signal handler for "copy" button.
	(FileDialogSetupItem): set sensitivity of "d->apply_all" by
	"d->multi_open".
	(FileDialog): initialize "d->multi_open".
	(FitDialogApply): check "poly_dimension" field is changed or not.
	(FileMoveDialogSetupItem, FileMoveDialogClose): execute
	"move_data_adjust" before get "move_data", "move_data_x" and
	"move_data_y".
	(FileDialogFit): delete instance of "fit" object when "ret ==
	IDCANCEL" and "create == FALSE".

	* src/gtk/x11axis.c (GridDialogSetup, AxisBaseDialogSetup)
	(AxisPosDialogSetup, NumDialogSetup, AxisFontDialogSetup)
	(GaugeDialogSetup, AxisDialogSetup): add signal handler for "copy"
	button.
	(SectionDialogGrid): delete instance of "axisgrid" object when
	"ret == IDCANCEL" and "create == FALSE".
	(SectionDialogGrid): don't call "set_graph_modified()" when
	"axisgrid" object is not created.

	* src/gtk/x11gui.c (set_sensitivity_by_check_instance): add.
	(DialogExecute): call "gtk_widget_hide_all()" before call
	"gtk_widget_show_all()".

	* src/shellcm.c (dispfield): change field size for field name from
	15 to 16.

	* src/gtk/x11view.c (mouse_down_move_data): execute
	"move_data_adjust" before get "move_data", "move_data_x" and
	"move_data_y".

	* src/oprm.c (prmload): execute "move_data_adjust" before get
	"move_data", "move_data_x" and "move_data_y".

	* src/ofile.c (adjust_move_num): add.
	(file2d): add field "move_data_adjust".
	(opendata): execute "move_data_adjust" before get "move_data",
	"move_data_x" and "move_data_y".

2009-01-13  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (menu_activate): add.
	(ViewerWinSetup): add signal handler for "selection-done" to
	"d->menu".
	(Evaluate): cursor type is "GDK_TCROSS" when move data mode.
	(mouse_down_move_data): check return value of "getobj()" and
	"getobjlist()" and goto "ErrEnd" when these functions rturn FALSE.
	(move_data_cancel): add argument "show_message".
	(mouse_down_move_data): check return value of "arraynget()".
	(do_popup): check id of focused object when "num == 1".

	* src/gtk/x11menu.h (struct Viewer): add member "menu".

	* src/gtk/x11menu.c (Cursor): add "GDK_TCROSS".
	(SetCursor): add case "GDK_TCROSS".
	(setupwindow): initialize "NgraphApp.Viewer.menu".

2009-01-11  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.h (enum MouseMode): add.
	(struct Viewer): member "MouseMode" and "Mode" are enum.

	* src/gtk/x11view.c (init_zoom): add.
	(mouse_down_move): use "get_mouse_cursor_type()" to check cursor
	position.
	(get_mouse_cursor_type): set "d->ChangePoint".
	(POINT_LENGTH, FOCUS_FRAME_OFST, FOCUS_RECT_SIZE): add.
	(ShowFocusFrame, get_mouse_cursor_type): use "FOCUS_RECT_SIZE" and
	"FOCUS_FRAME_OFST".
	(ShowPoints): use "POINT_LENGTH".

2009-01-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (do_popup): set sensitivity of popup item
	related to "VIEWER_POPUP_ITEM_UP" and "VIEWER_POPUP_ITEM_DOWN".
	(create_popup_menu): add "#error" directive to check array size.

2009-01-09  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.h (VIEWER_POPUP_ITEM_NUM): change value from 7
	to 9.

	* src/gtk/x11gui.c (GetColor): remove.

	* src/gtk/x11menu.c (application): change coror of "gray" from
	"#7f7f7f" to "#aaaaaa".

2009-01-08  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ogra2x11.c (gtkMakeRuler): use "GDK_INVERT" instead of
	"GDK_XOR".
	(gtkRGB): remove.

	* src/gtk/x11lgndx.c (clear_view): don't call
	"gdk_window_clear()".
	(LegendGaussDialogSetup): use "value-changed" signal instead of
	"change-value".

	* src/gtk/x11opt.c (DefaultDialogClose): use
	"sub_window_save_geometry()" to get geometry of a sub window.

	* src/gtk/x11menu.c (CmReloadWindowConfig): use
	"sub_window_hide()" to hide sub window.

	* src/gtk/x11info.c (CmInformationWindow): use "sub_window_show()"
	 and "sub_window_toggle_visibility()".

	* src/gtk/x11cood.c (CmCoordinateWindow): use "sub_window_show()"
	 and "sub_window_toggle_visibility()".

	* src/gtk/x11merge.c (CmMergeWindow): use "sub_window_show()" and
	 "sub_window_toggle_visibility()".

	* src/gtk/x11lgnd.c (CmLegendWindow): use "sub_window_show()" and
	 "sub_window_toggle_visibility()".

	* src/gtk/x11axis.c (CmAxisWindow): use "sub_window_show()" and
	 "sub_window_toggle_visibility()".

	* src/gtk/x11file.c (CmFileWindow): use "sub_window_show()" and
	 "sub_window_toggle_visibility()".

	* src/gtk/gtk_subwin.c (set_geometry): add argument "state" and
	save window state.
	(sub_window_save_geometry): save window state.
	(sub_window_hide, sub_window_show, sub_window_toggle_visibility):
	add.
	(cb_del): just call "sub_window_hide()".

2009-01-07  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (CmReloadWindowConfig): call
	"sub_window_set_geometry()" after show the window.

	* src/gtk/x11cood.c (CmCoordinateWindow): call
	"sub_window_save_geometry()" before hide.
	(CmCoordinateWindow): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/x11axis.c (CmAxisWindow): call
	"sub_window_save_geometry()" before hide.
	(CmAxisWindow): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/x11file.c (CmFileWindow): call
	"sub_window_save_geometry()" before hide.
	(CmFileWindow): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/x11lgnd.c (CmLegendWindow): call
	"sub_window_save_geometry()" before hide.
	(CmLegendWindow): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/x11merge.c (CmMergeWindow): call
	"sub_window_save_geometry()" before hide.
	(CmMergeWindow): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/x11info.c (InfoWinUpdate): call
	"sub_window_save_geometry()" before hide.
	(InfoWinUpdate): call "sub_window_set_geometry()" after call
	"gtk_widget_show_all()".

	* src/gtk/gtk_subwin.c (sub_window_set_geometry)
	(sub_window_save_geometry): add.
	(cb_show): call "sub_window_set_geometry()".
	(cb_del): call "sub_window_save_geometry()".

	* src/gtk/x11view.c (ShowFocusFrame): use
	""Menulocal.focus_frame_type" for line attribute of focus frame.

	* src/gtk/x11opt.c (DefaultDialogClose): save
	"Menulocal.focus_frame_type".
	(MiscDialogSetupItem): setpu "d->fftype".
	(MiscDialogClose): set "Menulocal.focus_frame_type".

	* src/gtk/ox11menu.h (struct menulocal): add member
	"focus_frame_type".

	* src/gtk/ox11menu.c (MenuConfig): add item for
	"focus_frame_type".
	(menuinit): initialize "Menulocal.focus_frame_type".

	* src/gtk/x11menu.c (show_instance_menu_cb)
	(set_show_instance_menu_cb, struct show_instance_menu_data): add.
	(create_filemenu, create_axisgridmenu, create_axismenu)
	(create_mergemenu, create_outputmenu): call
	"show_instance_menu_cb()".
	(create_legendmenu): call "g_signal_connect()" for "show" signal.
	(create_legendsubmenu): return "menu".

2009-01-06  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/object.c: variable "looproot" is static.
	(has_eventloop): add.

	* src/shell.c (msleep): add.
	(cmdexec): don't set "WNOHANG" when "has_eventloop()" returns
	FALSE.
	(cmdexec): use "msleep()" after call "eventloop()".

	* src/shellux.c (cmsleep): use "sleep()" when "has_eventloop()"
	returns FALSE.
	(cmsleep): use "msleep()" after call "eventloop()".

	* demo/demo.ngp.in: add.

	* src/gtk/gtk_subwin.c (sub_window_create): add argument "xpm2"
	and call "gtk_window_set_icon_list()" when "xpm2" is not NULL.

	* src/gtk/x11bitmp.c: add "Axiswin48_xpm", "Coordwin48_xpm",
	"Filewin48_xpm", "Infowin48_xpm", "Legendwin48_xpm" and
	"Mergewin48_xpm".

	* src/gtk/x11menu.c (struct command_data): remove member "xbm".

	* src/gtk/x11bitmp.c: remove xbm data.

	* src/gtk/x11menu.c (createpixmap, createicon): use
	"gdk_pixbuf_new_from_xpm_data()" instead of
	"create_pixbuf_from_xpm()".

	* src/gtk/gtk_subwin.c (sub_window_create): use
	"gdk_pixbuf_new_from_xpm_data()" instead of
	"create_pixbuf_from_xpm()".

	* src/gtk/x11menu.c (create_pixbuf_from_xpm): remove.

2009-01-04  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/terminal.c (my_signal): add.
	(main): use "my_signal".

	* src/gtk/main.c: variables "consolecol", "consolerow",
	"consolefdout", "consolefdin", "consoleac" and "systemname" are
	static.
	(interruptconsole, inputynconsole, displaydialogconsole)
	(displaystatusconsole): these functions are static.

	* src/osystem.c (systemresize): don't check "data[0]" and
	"data[1]".

2009-01-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (create_cursor): use "gdk_cursor_new()"
	instead of "gdk_cursor_new_for_display()".

	* src/gtk/main.c: remove global variable "Disp".

	* src/gtk/x11view.c (OpenGC): don't call
	"gdk_display_get_default()".

	* src/gtk/ogra2x11.c (gtkflush): add.

	* src/gtk/ox11menu.c (mxflush): don't call "gdk_display_flush()".

	* src/gtk/x11view.c (CloseGC, ReopenGC): don't call
	"gdk_display_flush()".

2009-01-02  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/terminal.c (main): use named pipe.
	(main): use "pause()" to waite termination.

	* src/gtk/main.c: global variables "terminal", "consolesave",
	"consolefd[]" and "consolepid" are static.
	remove unused variable "pipefd".
	(nallocconsole): use named pipe.
	(nfreeconsole): use "kill()" to terminate "nterminal".

2008-12-31  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/main.c (putconsole, printfconsole, inputynconsole)
	(nallocconsole): check return value of "write()".
	(nfreeconsole): check value of "pipefd".

	* src/gtk/ogra2x11.c (gtkflush): remove.
	(gra2gtk): remove field "flush".
	(gra2gtk): rename field "redraw" to "expose".
	(gra2gtk): add field "dpix" and "dpiy".
	(gtkinit): "gtkevpaint()" is connected to "gtklocal->View".
	(gdkgc_set_arc_mode, gdkgc_set_fill_rule): remove.
	(gtkinit): show error message when "OpenApplication()" returns
	FALSE.

2008-12-30  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* demo/demo.ngp: add.

	* src/gtk/x11view.c (AlignFocusedObj, ViewDelete, ViewCopy)
	(ViewCross): do nothing when "Menulock" or "GlobalLock" is TRUE.
	(mouse_up_zoom): minimum value of "zm" is 1000.

	* src/gtk/x11opt.c (CmOptionSaveNgp): do nothing when "Menulock"
	or "GlobalLock" is TRUE.

	* src/gtk/x11graph.c (CmHelpAbout, CmHelpHelp): do nothing when
	"Menulock" or "GlobalLock" is TRUE.

	* src/gtk/ogra2x11.c (gtkclear): clear pixmap.
	(gtk_set_dpi): add.
	(gra2gtk): add filed "dpi".

	* src/gtk/x11scrip.c (CmScriptExec): use "menu_lock()" to lock
	gui.

	* src/gtk/x11menu.c (menu_lock): add

	* src/gtk/x11graph.c (CmGraphShell): use "menu_lock()" to lock
	gui.

	* src/gtk/x11file.c (select_type, start_editing_type)
	(start_editing, edited_axis):  use "menu_lock()" to lock
	gui.

	* src/gtk/x11commn.c (LoadNgpFile): use "menu_lock()" to lock gui.
	(LoadNgpFile): call "registerevloop()" and "unregisterevloop()"
	before and after call "_exeobj()" respectively.

	* src/gtk/x11axis.c (start_editing, edited): use "menu_lock()" to
	lock gui.

	* src/gtk/ox11menu.c (mx_print): use "menu_lock()" to lock gui.
	(gtkmenu): type of "print" field is "NVFUNC".

	* src/gtk/gtk_subwin.c (start_editing, cancel_editing)
	(numeric_cb, string_cb):  use "menu_lock()" to lock
	gui.

	* src/shellux.c (cmsleep): call "sleep()" while wating timeout.

2008-12-28  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (mouse_up_drag): move object only when
	"dx != 0 || dy != 0".
	(mouse_up_change): change object only when "dx != 0 || dy != 0".
	(mouse_up_zoom): zoom object only when "zm != 0 && zm != 10000".

2008-12-26  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/omark.c (marktype): add.
	(mark): check marktype.

	* demo/demo5b.ngp (text): maximum value of "i" is 8.

	* src/gtk/x11view.c (ShowFrameRect, ShowPoints, ShowFocusLine)
	(ShowFocusFrame): do not call "gdk_gc_set_dashes()".

	* src/gtk/x11lgndx.c (LegendGaussDialogPaint): do not call
	"gdk_gc_set_dashes()".

	* src/gtk/x11dialg.c: remove variables "Dashes" and "DashesNum".

	* src/gtk/x11view.c (get_mouse_cursor_type): bug fix: fix
	conditions for "GDK_TOP_RIGHT_CORNER".

	* src/gtk/ogra2cairo.c (draw_str): create PangoLayoute only when
	"local->layout" is NULL.
	(gra2cairo_init): initialize "local->layout".
	(gra2cairo_free): unref "local->layout" if "local->layout" is not
	NULL.

	* src/gtk/ogra2cairo.h (struct gra2cairo_local): add member
	"layout".

2008-12-25  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* initfile/.Ngraph: add "-gra" option.
	do not create new "gra" object after evaluate ngp file.

2008-12-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (new_merge_obj, new_file_obj)
	(text_dropped, ViewerWinFileUpdate, Evaluate, Trimming)
	(AlignFocusedObj, mouse_down_move_data, mouse_up_drag)
	(mouse_up_zoom, mouse_up_change, create_legend1, create_legend2)
	(create_legend3, create_legendx, create_single_axis)
	(create_axis, ViewerEvKeyUp, ViewUpdate, ViewDelete)
	(reorder_object, ViewCopyAxis, ViewCopy): use
	"set_graph_modified()".
	(graph_dropped): use "reset_graph_modified()".

	* src/gtk/x11merge.c (CmMergeOpen, CmMergeClose, CmMergeUpdate):
	use "set_graph_modified()".

	* src/gtk/x11lgnd.c (legend_dialog_close, CmLineDel)
	(CmLineUpdate, CmCurveDel, CmCurveUpdate, CmPolyDel)
	(CmPolyUpdate, CmRectDel, CmRectUpdate, CmArcDel, CmArcUpdate)
	(CmMarkDel, CmMarkUpdate, CmTextDel, CmTextUpdate)
	(LegendWinLegendUpdate): use "set_graph_modified()".

	* src/gtk/x11graph.c (CmGraphSwitch, CmGraphPage): use
	"set_graph_modified()".
	(CmGraphLoad, CmGraphHistory): use "reset_graph_modified()".

	* src/gtk/x11file.c (MathDialogList, FileMaskDialogClose)
	(FileLoadDialogClose, FileDialogCopyAll, CmFileHistory)
	(CmFileNew, CmFileOpen, CmFileClose, CmFileUpdate)
	(FileWinFileDelete, file_obj_copy, FileWinFileUpdate)
	(FileWinFileDraw, select_type, edited_axis): use
	"set_graph_modified()".

	* src/gtk/x11dialg.c (SetObjPointsFromText, SetObjFieldFromText)
	(SetObjFieldFromSpin, SetObjFieldFromToggle)
	(SetObjFieldFromStyle, SetObjFieldFromList)
	(SetObjFieldFromFontList, SetObjAxisFieldFromWidget)
	(_putobj_color): use "set_graph_modified()".

	* src/gtk/x11commn.c (CheckSave): use "get_graph_modified()".
	(GraphSave): use "reset_graph_modified()".

	* src/gtk/x11axis.c (SectionDialogGrid, CmAxisNewFrame)
	(CmAxisNewSection, CmAxisNewCross, CmAxisNewSingle, CmAxisDel)
	(CmAxisZoom, CmAxisClear, CmAxisGridNew, CmAxisGridDel)
	(CmAxisGridUpdate, AxisWinExpose, edited): use
	"set_graph_modified()".

	* src/gtk/ox11menu.h: add prototype of "get_graph_modified",
	"reset_graph_modified" and "set_graph_modified".
	

	* src/gtk/ox11menu.c (get_graph_modified, reset_graph_modified)
	(set_graph_modified): add
	(menuinit): initialize "modified" field.
	(gtkmenu): add "modified" field.

	* src/gtk/gtk_subwin.c (copy, delete, move_top, move_last)
	(move_up, move_down, modify_numeric, modify_string, hidden)
	(tree_copy, tree_delete, tree_move_top, tree_move_last)
	(tree_move_up, tree_move_down, tree_hidden): use
	"set_graph_modified()".

	* addin/math.nsc: set +e and check return value of dexpr.

	* src/gtk/x11dialg.h (struct MiscDialog): add menber "Obj" and
	"Id".

	* src/gtk/x11menu.c (init_ngraph_app_struct): initialize
	"NgraphApp.Interrupt".

	* src/gtk/x11menu.h (struct NgraphApp): remove unused member
	"interrupt" and "Changed".

	* src/gtk/x11opt.c (ViewerDialogClose): call "putobj()" to set
	"redraw_num" field.
	(MiscDialog): add argument "struct objlist *obj" and "int id".
	(CmOptionMisc): add argument to call "MiscDialog()".
	(MiscDialogClose): call "putobj()" to save "data_head_lines".

	* src/gtk/ox11menu.c (gtkmenu): type of "redraw_num" field is
	"NINT".

2008-12-20  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ox11menu.c (menuerrorlist): add message "cannot open
	display.".
	(enum): add error identifier.
	(menuinit): call "error()" when "OpenApplication()" returns FALSE.

	* src/gtk/ox11dlg.c (dlginit): call "error()" when
	"OpenApplication()" returns FALSE.

2008-12-19  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (set_data_progress): check if "frac" is greater than
	1 or not.

2008-12-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (kill_signal_handler): add.
	(childhandler): use "sigaction()" instead of "signal()".
	(AppMainLoop): call "CheckSave()" when "Hide_window" is TRUE.
	(application): use "sigaction()" instead of "signal()".
	(application): set signal handler for "SIGINT" signal.

	* src/gtk/x11graph.c (CmGraphQuit): just call "QuitGUI()".

	* src/gtk/x11opt.c (MiscDialogSetup): change design of the dialog.

	* src/gtk/x11view.c (enum ViewerPopupIdn): add "VIEW_UP" and
	"VIEW_DOWN".
	(enum object_move_type): add.
	(create_popup_menu): add up and down object menu item.
	(ViewerPopupMenu): add case "VIEW_DOWN" and "VIEW_UP".
	(reorder_object): change argument from int to "enum
	object_move_type".

	* src/gtk/ogra2cairo.c (gra2cairo_output): don't draw arc if "w"
	or "h" is 0 in the case of "code" is 'C'.

	* src/otext.c (textzoom): minimum value of "pt" is 1.

	* src/orect.c (rectzoom): minimum value of "width" is 1.

	* src/omark.c (markzoom): minimum value of "size" and "width" is 1.
	(markgeometry): use temporal variable "val".

	* src/olegend.c (legendzoom): minimum value of "width" is 1.

	* src/oarc.c (arcgeometry): use temporal variable "val".
	(arczoom): minimum value of "rx", "ry", and "width" is 1.

2008-12-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (FileWinFileDraw): check if the graph is
	changed or not.

	* src/oline.c (arrowbbox): bug fix: add valiable "num2" and "num2"
	is used only to calculate positions of an arrow.

	* src/gtk/x11view.c (Match): return matched instance number.
	(mouse_up_point): change cursor if any object is focused.

	* src/gtk/ox11menu.c (gtkmenu): add field "draw".
	(mxdraw): add.
	(mx_redraw): call "gdk_window_invalidate_rect()".

	* src/gtk/x11merge.c (MergeDialogSetup): use
	"gtk_check_button_new_with_mnemonic()" instead of
	"gtk_check_button_new_with_label()".

	* src/gtk/x11gui.c (FileSelectionDialog): use
	"gtk_check_button_new_with_mnemonic()" instead of
	"gtk_check_button_new_with_label()".

2008-12-16  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (struct viewer_popup): add member "submenu_item_num".
	(create_menu): add argument "int n".
	(create_menu): add separator when "popup[i].title" is NULL.
	(create_popup_menu): add separator to menus.

	* src/gtk/x11merge.c (Mlist): add separator.
	(Mlist): "file" column is editable.

	* src/gtk/x11lgnd.c (Popup_list): add separator.

	* src/gtk/x11file.c (Flist): minimum value of "step" is 1.
	(Popup_list): add separator.

	* src/gtk/x11axis.c (Popup_list): add separator.
	(Popup_list): add clear menu item.
	(axiswin_scale_clear): add.

	* src/gtk/gtk_subwin.c (sub_win_create_popup_menu): add
	"GtkSeparatorMenuItem" when "list[i].title" is NULL.

2008-12-15  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (find_gra2gdk_inst): bug fix: always get
	"_local" field.

2008-12-12  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ogra2x11.c (struct gtklocal): remove unused member
	"autoredraw", "cmap" and "minus_hyphen".
	(gra2gtk): remove unused field "auto_redraw".

	* src/gtk/ox11menu.h (struct mxlocal): remove unused member
	"privatecolor", "cmap", "cdepth", "cairo_save", "minus_hyphen" and
	"points".
	(struct menulocal): remove unused member "mousecloick" and
	"movechild".

	* src/gtk/x11menu.c (createcommand1, createcommand2): check
	"Menulocal.showtip".

	* src/gtk/gtk_liststore.c (create_column): set page_size of
	GtkAdjustment as 0.

2008-12-09  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/shellcm.c (cmecho): add "-n" option.

2008-12-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (getdata_skip_step): call "memfree(buf)" when
	"rcode" is 1 or -1.

2008-12-02  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (search_mask): add.
	(getdata_sub2, getdata2, getdataraw): use "search_mask()".
	(struct f2ddata): add member "mask_index".
	(opendata, reopendata): initialize "fp->mask_index".

2008-12-01  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ox11dlg.c

	* src/gtk/x11gui.c (DialogRadio, DialogCombo, DialogCheck): add
	label if "caption" is not NULL.
	(DialogComboEntry): add.

	* src/gtk/ox11dlg.c (dlgconfirm, dlgmessage, dlgradio, dlgcombo)
	(dlgcheck): check and use "title" field.
	(dlginput, dlgradio, dlgcombo, dlgcheck): check and use "caption"
	field.
	(dlgcombo_entry): add.
	(dialog): add "combo_entry", "title" and "caption" field.

2008-11-28  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ox11dlg.c (dlggetopenfile, dlggetopenfiles)
	(dlggetsavefile): second argument is used as an initial file name.

	* src/gtk/x11gui.c (FileSelectionDialog): check "type" before call
	set name.
	(fsok): check "filter".

	* src/gtk/ox11dlg.c (dlgcombo): add.
	(dialog): add field "combo".
	(dlggetsavefile, dlggetopenfile): use "memfree()" to free "*(char
	**)rval".

	* src/gtk/x11gui.c (DialogCombo): add.

	* demo/encoding.ngp: use "dialog::combo" instead of
	"dialog::input".

2008-11-27  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ox11dlg.c (dlgcheck, dlgradio): add.
	(dialog): add fields "radio" and "check".
	now all functions dfined in ox11dlg.c is static.

	* src/gtk/x11gui.h: add prototype of "DialogCheck" and "DialogRadio"

	* src/gtk/x11gui.c (DialogCheck, DialogRadio): add.

	* src/gtk/ox11menu.h (struct menulocal): remove unused member
	"framex", "framey" and "exwinbackingstore".
	(struct mxlocal): remove unused member "backingstore".

	* src/gtk/ox11menu.c (enum menu_config_type)
	(menu_config_menu_geometry, menu_config_file_geometry)
	(menu_config_axis_geometry, menu_config_legend_geometry)
	(menu_config_merge_geometry, menu_config_dialog_geometry)
	(menu_config_coord_geometry, struct menu_config, MenuConfig)
	(MenuConfigHash, menu_config_set_four_elements)
	(menu_config_set_window_geometry, menu_config_set_bgcolor)
	(menu_config_set_ext_driver, menu_config_set_prn_driver)
	(menu_config_set_script, set_menu_config_mxlocal): add.
	(addmenu): initialize "MenuConfigHash".
	(mgtkloadconfig, mgtkwindowconfig): use "FileConfigHash".

2008-11-26  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c add global valiable "FileConfigHash".
	(enum file_config_type, struct file_config, FileConfig): add.
	(f2dloadconfig): use "FileConfigHash".
	(addfile): initialize "FileConfigHash".

	* src/gtk/ox11menu.h (struct mxlocal): remove unused member "fontalias".

	* src/gtk/x11dialg.c (SetObjFieldFromFontList): free "fontalias".

	* src/gtk/main.c (get_obj_font_list): use
	"Gra2cairoConf->font_num".

	* src/gtk/ogra2cairo.c (free_font_map): add.
	(create_font_map): add.
	(loadconfig): use "create_font_map()"
	(init_conf): initialize "Gra2cairoConf->font_num".
	(free_fonts_sub): add.
	(free_conf): use "nhash_each" and "nhash_free" to free font maps.
	(loadfont): remove second argument and return "struct fontmap *".
	(loadfont): remove codes related with " Gra2cairoConf->font".
	(draw_str): change 4th argument.
	(gra2cairo_output): use "local->loadfont".

	* src/gtk/ogra2cairo.h: remove definition of "struct fontlocal".
	(struct fontmap): add member "PangoFontDescription *font".
	(struct fontmap): add member "struct fontmap *prev".
	(struct gra2cairo_local): remove member "loadfontf" and add member
	"loadfont".

2008-11-25  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/orect.c (rect): use "oputcolor()" to set value to fields
	"R2", "G2" and "B2".

	* src/omark.c (mark): use "oputcolor()" to set value to fields
	"R2", "G2" and "B2".

	* src/ofile.c (file2d): use "oputcolor()" to set value to fields
	"R2", "G2" and "B2".

	* src/odraw.c (draw): use "oputcolor()" to set value to fields
	"R", "G" and "B".

	* src/oroot.h: add prototype of "oputcolor()".

	* src/oroot.c (oputcolor): add.

	* src/gtk/x11dialg.c (SetFontListFromObj): use
	"Gra2cairoConf->fontmap_list_root" instead of
	"Gra2cairoConf->fontmaproot".
	(SetFontListFromObj): bug fix: check if "font" is NULL or not.
	(SetFontListFromObj): default value of "selfont" is now 0.
	(SetObjFieldFromFontList): use hash to search font alias.
	(_set_color): check value of "R", "G" and "B".

	* src/gtk/ogra2cairo.h (struct gra2cairo_config): add member
	"fontmap_list_root".

	* src/gtk/ogra2cairo.c: add global valiable "FontFace".
	(loadconfig): save font configuration to hash.
	(init_conf): init "FontFace" and "Gra2cairoConf->fontmaproot".
	(free_conf): use "nhash_free_with_memfree_ptr()" to free fontmap.
	(loadfont, gra2cairo_charheight): use hash to search font alias
	settings.

	* src/gtk/main.c (get_obj_font_list): use
	"Gra2cairoConf->fontmap_list_root" instead of
	"Gra2cairoConf->fontmaproot".

	* src/nhash.h: add prototype of "nhash_num()".

	* src/nhash.c (count_hash, nhash_num): add.

2008-11-21  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gra.c  (GRAcharascent, GRAchardescent, GRAcharwidth): return
	calculated value when return value of "__exeobj()" is not zero.

2008-11-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* initfile/.Ngraph: use new gra to create image file.

	* driver/ngp2.in: add.

	* driver/Makefile.am (ngp2): add.
	(bin_SCRIPTS): add.

2008-11-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ogra.c (oGRAopen): put error message when the return value
	of "GRAinit()" is false.

	* src/gra.c (GRAinit): don't return "ERROPEN" when
	"GRAClist[GC]output == -1".

2008-11-16  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/nhash.c (create_hash_with_hkey): fix condition (from "lr ==
	-1" to "lr < 0").

	* src/gtk/main.c (main): check return value of "newobj()" and
	"chkobjinst()".
	

2008-11-12  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11graph.c (CmGraphShell): create new instance when
	there are no instances of "shell" object.

	* src/shell.h (struct nshell): add member "deleted".

	* src/shell.c (cmdexecute): exit loop when "nshell->deleted" is
	true.
	(newshell): initialize "nshell->deleted".

	* src/oshell.c (cmddone): if "shlocal->lock" is true, set
	"shlocal->nshell->deleted" as 1.
	(cmdshell): exit roop when "nshell->deleted" is true.
	(cmdshell): call "delshell()" when "nshell->deleted" is true.

	* src/nhash.c (nhash_del_with_hkey, nhash_del): check "h".

2008-11-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (FileDialogType): set sensitivity of parent widgets.

	* src/gtk/x11opt.c (use_external_toggled): set sensitivity of parent widgets.

	* src/gtk/x11graph.c (pagelist): fix label string of "Legal L".
	(PageDialogPage): set sensitivity of parent widgets.

2008-11-07  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (get_home): add.
	(createmenu): load accel map when "KEYMAP_FILE" is exist in
	"NGRAPH_HOME".

	* src/object.h (struct objlist): add member "fieldnum".

	* src/object.c (addobject): initialize "objnew->fieldnum".
	(chkobjfieldnum): return "obj->fieldnum" when value of
	"obj->fieldnum" is valid.

2008-11-06  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/shell.c (saveval): bug fix: "valcur->next" is NULL when
	"name" is found in nshell->valroot.

	* src/gtk/x11print.c (DriverDialogClose): change buffer size of a
	message.

	* src/shellcm.c (printexp): add.
	(cmexport, cmset): use hash when "USE_HASH" is true.

	* src/shell.c (create_vallist, free_vallist): add.
	(addval, saveval, restoreval, addexp, delval, getval, getexp)
	(newfunc, addfunc, getfunc, cmdexec, newshell, delshell): use hash
	when "USE_HASH" is true.

	* src/object.c (ARGBUFNUM): change value from 10 to 32.

	* src/nhash.c (free_hash_list): add argument "free_ptr".
	(free_hash_list): call memfree() when "free_ptr" is true.
	(nhash_free): add second argument.
	(nhash_free_with_memfree_ptr, create_hash_with_hkey)
	(nhash_set_int_with_hkey, nhash_set_ptr_with_hkey)
	(nhash_get_with_hkey, nhash_get_int_with_hkey)
	(nhash_del_with_hkey, nhash_get_ptr_with_hkey): add.

2008-10-23  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c: add macro "check_infinite()".
	(getdataarray, f2dsettings): use "check_infinite()".

2008-10-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (f2dinit): initialize "line_join" as "bevel".

2008-10-20  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/main.c (main): call 'init_cmd_tbl()'.

	* src/shellcm.c (cmtype): use 'check_cpcmd()' and 'check_cmd()'.

	* src/shell.c (init_cmd_tbl, check_cmd, check_cpcmd): add.
	(checkcmd): use 'check_cpcmd()'.
	(cmdexec): use 'check_cmd()'.

2008-10-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/shell.c (cmdtable): add setting for 'seq'.

	* src/shellcm.c (cmseq): add.

2008-10-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11graph.c (set_objlist_btn_state)
	(set_drawlist_btn_state): add.
	(SwitchDialogAdd, SwitchDialogInsert, SwitchDialogRemove): call
	set_drawlist_btn_state() after call SwitchDialogSetupItem().
	(SwitchDialogSetup): set_drawlist_btn_state() and
	set_objlist_btn_state() after call SwitchDialogSetupItem().
	(drawlist_sel_cb, objlist_sel_cb): add.

	* src/gtk/x11dialg.h (struct SwitchDialog): add member "top",
	"up", "down", "bottom", "del", "ins", "add" and "btn_lock".

2008-10-08  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11graph.c (SwitchDialogDown, SwitchDialogUp): add.
	(SwitchDialogSetup): add 'GO UP' and 'GO DOWN' button.
	(SwitchDialogLast): select last item after move object.
	(SwitchDialogTop): select first item after move object.

	* src/gtk/x11view.c (ViewDelete): set mouse cursor to GDK_LEFT_PTR
	after delete objects.

	* src/otext.c (textprintf): add 'G' to the conversion specifier.
	(textprintf): check format string.

	* src/gra.c (GRAexpandpf): add 'G' to the conversion specifier.
	(GRAexpandpf): check format string.

2008-10-07  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11scrip.c (CmScriptExec): call
	gdk_window_invalidate_rect() after execute script.

2008-10-06  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (FileMaskDialogClose): don't check if the line
	number is already contained in mask.

	* call arrayuniq_int() after call arrayuniq_int().

	* src/object.c (arrayndel): use memmove() instead of memcpy().
	(arrayuniq_int): add

	* src/gtk/x11view.c (Evaluate): call file::modified when add mask
	points.

	* src/ofile.c (opendata): initialize fp->num.
	(closedata): add argument "f2dlocal".
	(closedata): set fp->datanum to f2dlocal->num.
	(f2ddone, getminmaxdata, f2ddraw, f2devaluate, f2dopendata)
	(f2dgetdata, f2dclosedata, f2dopendataraw, f2dgetdataraw)
	(f2dclosedataraw, f2dstat, f2dstat2, f2dboundings)
	(f2doutputfile): add argument to closedata().
	(get_mtime): add.
	(f2dstat): use get_mtime() to check mtime.
	(fitout): remove closedata().

2008-10-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (update_mask): add.
	(file2d): use update_mask() for "mask" field.
	(getdataraw, getdata2, getdata_sub2): use bsearch_int() to check
	mask.

	* src/gtk/x11view.c (Evaluate): add masked line as sorted.

	* src/object.c (cmp_func_int, arraysort_int): add.

	* src/mathfn.c (bsearch_int): add.

2008-09-25  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (ViewerEvKeyDown): add case "GDK_Page_Up" and
	"GDK_Page_Down".
	(ViewerEvKeyDown): in case of GDK_Down, GDK_Up, GDK_Left and
	GDK_Right, scroll screen if no objects are focused.

2008-09-24  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (getdata_sub2, getdata_skip_step): add.
	(getdata_sub1): use getdata_sub2().
	(struct f2ddata): use enum instead of int for 'type'.

2008-09-23  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* initfile/.Ngraph (check_set): add.
	* initfile/.Ngraph: use check_set to initialize file object.
	

2008-09-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (struct f2ddata): add member 'mtime' and
	'interrupt'.
	(opendata): set mtime to 'fp->mtime'.
	(check_mtime): add.
	(getminmaxdata): call check_mtime() and hskipdata().
	(f2ddraw, f2devaluate, f2dopendata, f2dstat, f2dstat2)
	(f2dboundings, f2doutputfile): remove check_mtime() placed before
	getminmaxdata().
	(f2dstat): check if 'f2dlocal->mtime == fp->mtime'.

2008-09-19  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (FileMoveDialogAdd, FileMoveDialogRemove)
	(FileMoveDialogCopy): set 'd->changed' as 'TRUE'.
	(FileMoveDialogClose, FileMaskDialogClose): do nothing when
	'd->changed' is 'FALSE'.
	(FileMaskDialog, FileMoveDialog): initialize 'data->changed'.

	* src/gtk/gtk_widget.h (enum SPIN_BUTTON_TYPE): add
	'SPIN_BUTTON_TYPE_NATURAL'.

	* src/gtk/gtk_widget.c (create_spin_entry_type): add case
	'SPIN_BUTTON_TYPE_NATURAL'

	* src/gtk/x11dialg.h (struct FileMoveDialog)
	(struct FileMaskDialog): add member 'changed'.

	* src/gtk/x11view.c (ViewerWinFileUpdate, ViewUpdate): set
	'NgraphApp.Changed' as 'TRUE' only when return value is
	'IDDELETE'.

	* src/gtk/x11merge.c (CmMergeClose): set 'NgraphApp.Changed' as
	'TRUE' only when return value is 'IDDELETE'.

	* src/gtk/x11lgnd.c (legend_dialog_close): check if the value is
	really changed.
	(CmLineUpdate, CmCurveUpdate, CmPolyUpdate, CmRectUpdate)
	(CmArcUpdate, CmMarkUpdate, CmTextUpdate, LegendWinLegendUpdate):
	set 'NgraphApp.Changed' as 'TRUE' only when return value is
	'IDDELETE'.

	* src/gtk/x11file.c (MathDialogList): remove AddMathList().
	(MathDialogList): check if the math text is really changed.
	(FitDialogApply): do not set 'TRUE' to 'NgraphApp.Changed'.
	(FileLoadDialogClose): check if the ifs text is really changed.
	(FileDialogCloseCommon): call SetObjAxisFieldFromWidget().
	(FileDefDialogClose): remove duplicate settings.

	* src/gtk/x11axis.c (CmAxisUpdate, CmAxisGridUpdate): do not set
	'TRUE' to 'NgraphApp.Changed' when the return value is not IDOK.

	* src/gtk/x11file.c (FileDialogCloseCommon): use
	SetObjAxisFieldFromWidget().

	* src/gtk/x11axis.c (GridDialogClose, AxisPosDialogClose)
	(AxisDialogClose): use SetObjAxisFieldFromWidget().

	* src/gtk/x11dialg.c (SetObjPointsFromText, SetObjFieldFromText)
	(SetObjFieldFromSpin, SetObjFieldFromToggle)
	(SetObjFieldFromStyle, SetObjFieldFromList)
	(SetObjFieldFromFontList, _putobj_color): check if the value is
	really changed.
	(SetObjAxisFieldFromWidget): add

	* src/gtk/gtk_subwin.c (update): do not set 'TRUE' to
	'NgraphApp.Changed'.

	* src/ofile.c (struct f2dlocal): add member "sumx, sumy, sumxx,
	sumyy, sumxy, minx, maxx, miny, maxy, num and mtime".
	(f2dfile, f2dput): set 'f2dlocal->mtime' as 0.
	(update_field, foputabs, foputge1): add.
	(getminmaxdata): add argument 'local'.
	(f2ddraw, f2devaluate, f2dopendata, f2dstat, f2dstat2)
	(f2dboundings, f2doutputfile): add argument to getminmaxdata().

2008-09-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (opendata): check mtime of the file.
	(file2d): add field "mtime".

	* src/gtk/x11commn.c (FileAutoScale): return when fail to allcate
	memory.

	* src/ofile.c (f2dbounding): return 1 when error is occurred.

	* src/oaxis.c (axisautoscalefile): check the return value of
	getobj().
	(axisautoscale): return 1 when the return value of
	axisautoscalefile() is not 0.

	* src/gtk/x11print.c (CmPrintDataFile): check the return value of
	exeobj().

	* src/gtk/ogra2gtkprint.c (create_cairo): show error message when
	error is occurred.

	* src/ofile.c (f2doutputfile): show error message when error is
	occurred.

	* src/gtk/x11menu.c (PutStdout, PutStderr): convert string from
	locale to UTF-8.

2008-09-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11print.c (draw_gra): check the return value of
	exeobj().

	* src/gtk/x11gui.c (fsok): set NULL to data->ext when filer name
	is "All".
	(fsok): call error22() after call gdk_beep().

	* src/gtk/ogra2cairofile.c (create_cairo): add argument 'err' and
	set cairo_status to err.
	(gra2cairofile_output): call error2() when some error is occurred
	in the case of 'I' and 'E'.
	(addgra2cairofile): add error messages.

	* src/gtk/ogra2cairo.c (check_cairo_status): add.
	(gra2cairo_flush): call check_cairo_status().
	(gra2cairo_output): call check_cairo_status() in the case of 'I'
	and 'E'.
	(addgra2cairo): add error messages.

	* src/ogra.c (oGRAopen): check the return value of GRAinit().

	* src/gra.c (GRAreopen, GRAdraw, GRAinit, GRAend): return int.

	* src/ogra.h (ERROPEN): add.

2008-09-16  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/object.c (add_obj_to_hash): add.
	(addobject): set object name and table position to hash.
	(chkobject): use hash to search object.
	(chkobjtblpos): use hash to search table position.
	(chkobjoffset, chkobjfield): use chkobjtblpos().

	* src/object.h (struct objlist): add member 'table_hash'.

	* src/nhash.h: add.

	* src/nhash.c: add.

2008-09-12  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11opt.c (DefaultDialogClose, ExViewerDialogSetupItem)
	(ExViewerDialogSetup): add settings for 'use_external'.
	(use_external_toggled): add.

	* src/gtk/ox11menu.h (struct menulocal): add member
	"exwin_use_external".

	* src/gtk/x11dialg.h (struct ExViewerDialog): add member
	"use_external".

	* src/gtk/x11print.c (draw_gra): use 'exeobj()' to call "open"
	member function.
	(CmOutputViewer): add argument 'select_file'.
	(CmOutputViewer): use "menu::print" instead of "gra2gtk".
	(CmOutputMenu, CmOutputViewerB): add argument to call
	CmOutputViewer().
	(CmOutputPrinterB): now second argument of CmOutputPrinter() is
	'FALSE'.

	* src/shellcm.c (cmset): use memmove().
	(cmobject): fix typo ("filed" to "field").

	* src/object.c (arrayndel2): use memmove().

2008-09-11  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11print.c (CmOutputPrinter): add argument 'int
	show_dialog'.
	(CmOutputPrinter): check 'show_dialog' when call
	gtk_print_operation_run().
	(CmOutputPrinterB): add argument when call CmOutputPrinter().
	(init_graobj): add.
	(CmOutputPrinter, CmOutputDriver, CmOutputViewer)
	(CmPrintGRAFile, CmOutputImage): use init_graobj().
	(draw_gra): add.
	(draw_page, CmOutputDriver, CmPrintGRAFile, CmOutputImage): use draw_gra().

	* src/gtk/x11menu.c (SetPoint, SetZoom, ResetZoom, SetStatusBar)
	(SetStatusBarXm, ResetStatusBar): check 'NgraphApp.Message' is
	NULL or not.
	(SetCursor): check 'NgraphApp.Cursor' is NULL or not.

	* src/gtk/x11graph.c (CmGraphMenu): add argument when call
	CmOutputPrinter().

	* src/gtk/ox11menu.c (mx_print): add.
	(gtkmenu): add member "print".

	* src/gtk/ogra2gtkprint.c (gra2gtkprint): remove member "next".

	* src/gtk/ogra2cairo.c (gra2cairo): remove member "next".

	* initfile/.Ngraph: add -p option.

2008-09-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11print.c (CmPrintGRAFile): set base-name of ngp file
	as default GRA filename.
	(get_base_ngp_name): add.
	(CmPrintGRAFile, CmOutputImage): use get_base_ngp_name().

	* src/gtk/ogra2cairo.c (draw_str, gra2cairo_charheight)
	(gra2cairo_charwidth):  check font size.

	* src/gtk/x11view.c (new_merge_obj, new_file_obj): add.
	(data_dropped): add argument 'file_type'. use new_file_obj() and
	new_merge_obj().

	* src/gtk/x11view.h: add prototype of data_dropped().

	* src/gtk/x11merge.c: include "x11view.h"
	(drag_drop_cb, init_dnd): add.
	(CmMergeWindow): call init_dnd().

	* src/gtk/x11file.c (drag_drop_cb, init_dnd): add.
	(CmFileWindow): call init_dnd().

	* src/gtk/x11menu.c (createcommand2): set signal handler for
	"button-press-event".

	* src/gtk/x11view.h: add prototype of CmViewerButtonPressed().

	* src/gtk/x11view.c: add 'KeepMouseMode'.
	(ViewerEvLButtonDblClk): call gtk_toggle_tool_button_set_active()
	when 'KeepMouseMode == FALSE'.
	(CmViewerButtonPressed): add.

2008-09-08  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (Focus): remove
	'gtk_toggle_tool_button_set_active()'.
	(check_focused_obj): now return index of found item.
	(Focus): remove gtk_toggle_tool_button_set_active().
	(ShowPoints): draw arc when 'd->Mode == ArcB'.
	(calc_snap_angle, calc_integer_ratio, SQRT3): add.
	(ViewerEvMouseMove): call calc_snap_angle() or
	calc_integer_ratio().

	* src/gtk/gtk_subwin.c (ev_key_down_tree): add 'break;' in the
	case of 'GDK_space'.
	(ev_key_down_tree): return 'FALSE' when shift key is pressed in
	the case of 'GDK_Return'.

2008-09-05  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (mouse_up_point): don't change cursor.
	(get_mouse_cursor_type): add.
	(set_mouse_cursor_hover): use get_mouse_cursor_type().

	* src/gtk/x11menu.c (Command2_data): remove MoveB.

2008-09-04  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (POPUP_ITEM_FIT): add.
	(popup_show_cb): check if the object associate with fit.

	* src/gtk/x11view.c (ViewerWinFileUpdate): call
	ProgressDialogCreate() before evaluate.
	(range_increment): add.
	(scrollbar_scroll_cb, ViewerEvScroll): use range_increment().
	(ViewerEvMouseMove): scroll when mouse position is out of the
	widget.
	(AlignFocusedObj): align to the paper when number of focused
	object is 1.
	(do_popup): set sensitivity of d->popup_item[3] as TRUE when 'num
	> 0'.

2008-09-01  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/gtk_subwin.c (start_editing): use snprintf() when
	'list->type == G_TYPE_STRING' and 'chkobjfieldtype(d->obj,
	list->name) == NDOUBLE' to set value.
	(modify_string): check if the value is really modified.

2008-08-29  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/gtk_subwin.c (ev_button_down, ev_button_down_tree):
	check 'event->time' to treat double click as double click.

2008-08-28  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11lgnd.c (legend_dialog_close): bug fix: call
	SetObjPointsFromText().

2008-08-27  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11lgnd.c (legend_dialog_close): bug fix: call
	SetObjFieldFromStyle().

	* src/gtk/x11opt.c (CmOptionViewer): uncomment 'ChangeDPI(TRUE);'.

	* src/gtk/x11dialg.h (struct MiscDialog): add 'data_head_lines'.

	* src/gtk/ox11menu.h (struct mxlocal): add 'data_head_lines'.

	* src/gtk/x11file.c (FileDialogSetup): use
	Mxlocal->data_head_lines.

	* src/gtk/ox11menu.c (mgtkloadconfig, menuinit): add settings for
	'Mxlocal->data_head_lines'.
	(mx_data_head_lines): add.
	(gtkmenu): add 'data_head_lines'.

	* src/gtk/x11opt.c (DefaultDialogClose, MiscDialogSetupItem)
	(MiscDialogSetup, MiscDialogClose): add settings for
	'Mxlocal->data_head_lines'.

2008-08-26  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (f2dhead): check the return value of nstrnew() is
	NULL or not.

	* src/gtk/x11gui.c (dialog_key_down_cb): return FALSE when 'w' key
	is pressed without control key.

	* src/gtk/gtk_subwin.c (ev_sub_win_key_down): return FALSE when
	'w' key is pressed without control key.

	* src/gtk/ogra2x11.c (ev_key_down): return FALSE when 'w' key is
	pressed without control key.

	* src/ofile.c (f2dhead): add line number.

	* src/ioutil.c (fgetnline): use fgetline().

2008-08-25  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (f2dhead): change length of 'buf' from 128 to 256.
	(f2dhead): use 'sizeof()' instead of immediate.

	* src/gtk/x11file.c (FileDialogSetup): change value of 'line' from
	10 to 20.

2008-08-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (struct f2ddata): add ifs_buf.
	(check_ifs_init, CHECK_IFS, CHECK_REMARK): add.
	(opendata): call check_ifs_init().
	(getdataarray, getdata_sub1, getdata2, getdataraw): use
	CHECK_REMARK and CHECK_IFS instead of strchr().

	* src/ioutil.c: add.
	(char_type_buf_init): add.
	(fgetline): use is_line_sep() when EOF == -1.

	* src/gtk/x11file.c (FileMoveDialogAdd): check if x and y are NaN or INF.

	* src/gtk/x11dialg.c (SetObjPointsFromText): check if d is NaN or INF.

	* src/gtk/gtk_subwin.c (numeric_cb): check if val is NaN or INF.

	* src/ofile.c (f2dsettings): check if f1, a2 and f3 are NaN or INF.

2008-08-21  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (struct f2ddata_buf): add.
	(struct f2ddata, opendata, closedata, getdata_sub1, getdata): use
	'struct f2ddata_buf'.

	* src/gra.c (GRAboundingbox): consider line width in the case 'R'.

	* src/ofile.c (reopendata): set fp->prev_datanum.
	(getdataraw): call set_data_progress().
	(getdataraw): increment fp->datanum in loop.

	* src/ioutil.c (fgetline): bug fix: increment 'i' only
	after nstraddchar().
	(fgetline) now '\r' is treated as line break.

2008-08-20  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (getdataarray): bug fix: check if val is NaN or INF.

	* src/ioutil.c (fgetline): use switch instead of if.

	* src/ofile.c (getdata_sub1): add.
	(getdata): use getdata_sub1().
	(getdata): use memmove() instead of loop.

	* src/axis.c (getaxispositionfirst): use alocal->inc instead of
	alocal->dposm to determine alocal->dposs.

2008-08-19  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gra.c (GRAboundingbox): now ch is int.
	(GRAboundingbox): first argument of Gracharwidth is '(ch & 0xff)'.

2008-08-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (select_type): set selected item to d->select.

	* src/gtk/x11menu.c (add_underscore): add.
	(show_graphmwnu_cb, show_filemwnu_cb): call add_underscore().

2008-08-15  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c: add.
	(create_graphmenu, create_axismenu): add accelerator.
	(create_toggle_menu_item): add.
	(create_windowmenu): use create_toggle_menu_item().

	* src/gtk/x11menu.h: add.

	* src/gtk/gtk_subwin.c (sub_window_create): add accel group to sub
	window.

	* src/gtk/x11view.c (AddList): bug fix: call GRAdellist() when
	inst2 == NULL.

2008-08-14  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11opt.c (DefaultDialogClose): check
	NgraphApp.FileWin.Win->window etc.

2008-08-11  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (MARK_PIX_SIZE): change mark size from 28 to 24.

	* src/gtk/x11file.c (create_type_combo_box): add.
	(select_type, start_editing_type): modified for tree model.

	* src/gtk/gtk_liststore.c (start_editing_obj): use GtkTreeModel
	for combo_box.

2008-08-08  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/gtk_liststore.c (start_editing_obj): add.
	(create_column): set some properties to GtkCellRenderer.
	set start_editing virtual function.

	* src/gtk/gtk_subwin.c (set_obj_cell_renderer_cb): add.

	* src/gtk/x11file.c (select_type, start_editing_type): add.
	(CmFileWindow): call set_obj_cell_renderer_cb.

2008-08-06  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* initfile/.Ngraph: add save_image().
	add -png, -ps, -eps, -pdf and -svg option.

	* src/gtk/main.c (inputynconsole): add message ' [yn] '.
	use strchr() to check input character.
	read while '\n' appear.

2008-08-05  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ox11menu.h (struct menulocal): add member 'expandtofullpath'

	* src/gtk/ox11menu.c (mgtkloadconfig): add condition for
	'expand_to_fullpath'
	(menuinit): initialize Menulocal.expandtofullpath.

	* src/gtk/x11commn.c (ToFullPath): add.
	(LoadNgpFile): call ToFullPath() when 'Menulocal.expandtofullpath
	&& (!ignorepath)'

	* src/ioutil.c (getfullpath): argument of changefilename() is
	'name'.

	* src/object.c (memrealloc): add sleep().

	* src/shellux.c (cmtest): add condition
	'(strcmp2(argv[i+1],"=")!=0) && (strcmp2(argv[i+1],"!=")!=0)'

	* src/jnstring.h: add.

	* src/jnstring.c: add.

	* src/ngraph.h (ALIGNSIZE): add.

2008-07-24  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (get_axis_obj_str): add.
	(file_list_set_val): use get_axis_obj_str().
	(start_editing): check axis object.

2008-07-23  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (select_axis, select_axis_x, select_axis_y):
	add.
	(start_editing): use "changed" signal.

	* src/gtk/x11axis.c (select_type): add.
	(start_editing): use "changed" signal.

2008-07-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (edited_y, edited_x, edited_axis)
	(start_editing): add.
	(CmFileWindow): call set_combo_cell_renderer_cb().

	* src/gtk/x11axis.c (start_editing, edited): add.
	(CmAxisWindow): call set_combo_cell_renderer_cb().

	* src/gtk/gtk_subwin.c (set_combo_cell_renderer_cb): add.

	* src/gtk/gtk_liststore.c (create_column): add case G_TYPE_ENUM.
	(create_tree_view): column type of G_TYPE_ENUM is string.

	* src/gtk/x11menu.c: add global variables RecentGraph and
	RecentData.
	(create_recent_graph_menu, create_recent_data_menu): add.
	(create_graphmenu): call create_recent_graph_menu.
	(create_filemenu): call create_recent_data_menu.

	* src/gtk/gtk_subwin.c (modify_numeric, modify_string): check the
	value is modified or not.
	(ev_button_down, ev_button_down_tree): return FALSE when locked.

2008-07-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11dialg.c (search_id): add.
	(SelectDialogSetup, SelectDialogSetup): add id column. check id
	column insteadof index.

	* src/gtk/x11lgnd.c (LegendLineCB, LegendRectCB, LegendArcCB)
	(LegendTextCB): remove id.

	* src/gtk/x11file.c (FitCB): remove id.

	* src/gtk/x11commn.c (FileCB): remove id.

	* src/gtk/x11axis.c (AxisDialogFile): always get scale type.
	(AxisDialogSetup): bug fix: widget type of Scale setting is
	GtkComboBox.
	(AxisCB, GridCB): remove id.

	* src/gtk/x11file.c (MathDialogSetup, MathDialogList): now math
	dialog can be sorted.

	* src/gtk/gtk_liststore.c (list_store_path_get_int): add.

	* src/gtk/x11file.c (FileMoveDialogSetup, FileMaskDialogSetup):
	now lists of masked and moved data are sorted by line number.

	* src/gtk/gtk_liststore.c (list_store_set_sort_column)
	(list_store_set_sort_all): add.

2008-07-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ogra2cairo.c (gra2cairo_output): in the case 'V' call
	cairo_reset_clip() before clip rectangle and restore clip region
	when local->region is not NULL.

	* src/shell.c (checkcmd): bug fix: initialize prmcur->prmno as
	NULL when prmcur->str[1] == ';'.
	(checkcmd): fix indent.

	* src/gtk/ogra2x11.c (gtkinit): free gra2cairo_local when failed.

	* src/gtk/ogra2gdk.c (g2g_init): free gra2cairo_local when failed.

	* src/gtk/ox11menu.c (menuinit): free gra2cairo_local when failed.

	* src/gtk/ogra2cairo.c (gra2cairo_free): add.
	(gra2cairo_init): call free_conf() only when Instance == 0.

	* src/gtk/ogra2cairofile.c (gra2cairofile_init): free
	gra2cairo_local when failed.

2008-07-16  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/gtk_subwin.c (start_editing, cancel_editing)
	(numeric_cb, string_cb): add.
	(set_cell_renderer_cb): set callback functions when type is
	G_TYPE_DOUBLE, G_TYPE_INT or G_TYPE_STRING.
	(modify_numeric, modify_string): add.

	* src/gtk/gtk_liststore.h (_list_store): add min, max, inc and
	page.

	* src/gtk/gtk_liststore.c (create_column): set "editable",
	"adjustment", "digits" and "user-data" properties to renderer when
	editable is TRUE.

	* src/ofile.c (closedata): call set_data_progress();

	* src/gtk/x11dialg.c (SetObjFieldFromWidget)
	(SetWidgetFromObjField): add.

2008-07-15  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11dialg.c (SetTextFromObjPoints)
	(SetObjPointsFromText): add.
	(SetObjFieldFromStyle): call SetObjPointsFromText() to set value.
	(SetStyleFromObjField): call SetTextFromObjPoints() to set value.

	* src/gtk/x11axis.c (Alist): type of 'x', 'y', 'dir' and 'len' are
	G_TYPE_DOUBLE.
	(axis_list_set_val): now position and length are shown in mm.
	direction is shown in degree.

	* src/gtk/x11file.c (Flist): type of 'size' and 'width' are
	G_TYPE_DOUBLE.
	(file_list_set_val): now size and width are shown in mm.


	* src/gtk/x11merge.c (Mlist): type of 'tm', 'lm' and 'zm' are
	G_TYPE_DOUBLE.
	(merge_list_set_val): now margin and zoom are shown in mm and
	percent respectively.

	* src/gtk/x11cood.c (CoordWinSetCoord): now position is shown in
	mm.

	* src/gtk/x11menu.c (SetPoint): now position is shown in mm.

	* src/gtk/x11lgnd.c (Llist): type of 'x' and 'y' are
	G_TYPE_DOUBLE.
	(LegendLineCB, LegendRectCB, LegendArcCB): now position is shown
	in mm.
	(legend_dialog_setup_item): use SetTextFromObjPoints() for
	"points" property.
	(legend_dialog_close): use SetObjPointsFromText() for "points"
	property.
	(legend_list_set_val): now position and size are shown in mm.

	* src/gtk/gtk_liststore.c (tree_store_set_double)
	(list_store_set_double): set formated string.
	(create_tree_view): set G_TYPE_STRING when type is G_TYPE_DOUBLE.

2008-07-14  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofile.c (curveoutfile): remove condition "getposition2(fp,
	fp->axtype, fp->aytype, &(fp->dx), &(fp->dy)) == 0"
	(opendata): bug fix: initialize some variables when "axis" is
	FALSE.

	* src/gtk/x11gui.c (fsok): bug fix: : add braces as "(n + 1)"
	in argument of malloc.

	* src/orect.c (rectzoom): check if x1 and y1 are equal to x2 and
	y2 respectively.

	* src/oaxis.c (axisput): use TEXT_SIZE_MIN macro.

	* src/oarc.c (arczoom): check value of rx and ry.

	* src/otext.c (textgeometry): use macro; TEXT_OBJ_SCRIPT_SIZE_MIN,
	TEXT_OBJ_SCRIPT_SIZE_MAX and TEXT_SIZE_MIN.

	* src/gtk/x11print.c (OutputDataDialogSetupItem)
	(OutputDataDialogClose): use GtkSpinButton.

	* src/gtk/x11opt.c (MiscDialogSetupItem, MiscDialogSetup)
	(MiscDialogClose, ExViewerDialogSetupItem, ExViewerDialogSetup)
	(ExViewerDialogClose, ViewerDialogSetupItem, ViewerDialogSetup)
	(ViewerDialogClose):  use GtkSpinButton.

	* src/gtk/x11merge.c (MergeDialogSetup):  use GtkSpinButton.

	* src/gtk/x11lgndx.c (LegendGaussDialogSetup):  use GtkSpinButton.

	* src/gtk/x11lgnd.c (legend_dialog_setup_item)
	(legend_dialog_close, width_setup, miter_setup)
	(LegendRectDialogSetup, LegendArcDialogSetup)
	(LegendMarkDialogSetup, legend_dialog_setup_sub)
	(LegendTextDialogSetup):  use GtkSpinButton.

	* src/gtk/x11graph.c (PageDialogSetupItem, PageDialogPage)
	(PageDialogSetup, PageDialogClose):  use GtkSpinButton.

	* src/gtk/x11file.c (FitDialogSetup, FileMaskDialogAdd)
	(FileLoadDialogSetup, FileMathDialogSetup)
	(FileDialogSetupCommon):  use GtkSpinButton.

	* src/gtk/x11dialg.c (SetObjFieldFromSpin, SetSpinFromObjField):
	use GtkSpinButton.

	* src/gtk/x11axis.c (gauge_syle_setup, SectionDialogSetupItem)
	(SectionDialogSetup, SectionDialogClose, CrossDialogSetupItem)
	(CrossDialogSetup, CrossDialogClose, ZoomDialogSetup)
	(ZoomDialogClose, AxisBaseDialogSetup, AxisPosDialogSetup)
	(NumDialogSetup, AxisFontDialogSetup, AxisDialogSetup): use
	GtkSpinButton.

	* src/gtk/gtk_widget.c: add.

2008-07-11  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/gtk_liststore.c (create_column): set "mode" attribute as
	GTK_CELL_RENDERER_MODE_ACTIVATABLE when the column is editable.

	* src/gtk/gtk_subwin.c (set_cell_renderer_cb, toggle_cb): add.
	(list_sub_window_create, tree_sub_window_create): call
	set_cell_renderer_cb().

2008-07-05  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11file.c (FileMoveDialogSetup, FileMaskDialogSetup):
	add copy button.
	(FileMaskDialogClose, FileMoveDialogClose): add case for IDCOPY.
	(FileMoveDialogCopy, FileMaskDialogCopy): add.

2008-07-04  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (SetCaption): free 'buf'.

	* src/ogra.c (set_progress_val): initialize progress bar when 'i == 0'.

	* src/gtk/ogra2cairo.c (gra2cairo_done): free 'local->fontalias'.

	* src/gtk/x11file.c (file_list_set_val, FileDialogSetupItem): free
	'valstr'.

	* src/gtk/ogra2cairo.c (free_conf): free fontmap.

	* src/gtk/gtk_entry_completion.c (add_completion): free 'buf'.

	* src/gtk/ogra2gtkprint.c (create_cairo): remove cairo_destroy().
	(gra2gtkprint_done): set NULL to local->cairo.

	* src/gtk/x11graph.c (PageDialogPage): width and height entry is
	sensitive only when paper type is custom.

	* src/gtk/ox11menu.h (struct menulocal): add PaperLandscape,
	PaperId and PaperName.
	(enum paper_id): add.

	* src/gtk/x11graph.c (PageDialogClose): check paper size.
	(set_paper_type): add.
	(struct pagelisttype, pagelist): add name, landscape and id;

	* src/gtk/x11commn.c (CheckPage): bug fix: remove redundant return.

2008-07-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11graph.c (CmGraphMenu): call CmOutputPrinter() when
	sel == MenuIdOutputDriver.

	* src/gtk/ogra2gtkprint.c: add.

	* src/gtk/x11print.c (CmOutputPrinter, draw_page)
	(struct print_obj): add.
	add global variable PrintSettings.

	* src/gtk/ogra2cairo.c (gra2cairo_output): save current point
	after call cairo_stroke() for graphic command 'T'.

	* src/ofile.c (fitout): fitout is now static.

	* src/ofit.c (fitpoly): bug fix: write information in 'buf'
	instead of 'equation'.

	* src/gtk/x11file.c (FitDialogSetupItem, FitDialogSave)
	(FitDialogApply): bug fix: poly_dimension is active item + 1.

	* src/gtk/x11commn.c (GetDrawFiles): add.

	* src/gtk/x11print.c (CmPrintDataFile): now CmPrintDataFile() can
	output multi data files into one file.

	* src/gtk/x11commn.c (SetFileHidden): add arraydel(&ifarray) when
	return value of DialogExecute() is not IDOK.

	* src/ofile.c (f2doutputfile): add append mode.
	(file2d): change arguments of "output_file" from "si" to "sib".

2008-07-02  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (create_pix): add settings for antialias.
	(OpenGC, ReopenGC): add settings for pixel_dot_x and pixel_dot_y.

	* src/gtk/x11opt.c (DefaultDialogClose, ViewerDialogSetupItem)
	(ViewerDialogSetup, ViewerDialogClose): add settings for antialias.

	* src/gtk/ox11menu.c (mgtkloadconfig, menuinit): add settings for
	antialias.
	(mxdpi): add settings for pixel_dot_x and pixel_dot_y.
	(mxd2p, mxd2px, mxd2py, mxp2d): use pixel_dot_x and pixel_dot_y.
	remove gtk_output().

	* src/gtk/ogra2x11.c (gtkinit): add settings for dpix and dpiy.
	(dot2pixel): use pixel_dot_x.

	* src/gtk/ogra2gdk.c (g2g_init): add settings for dpix and dpiy.

	* src/gtk/ogra2cairofile.c (gra2cairofile_init): add settings for
	dpix and dpiy

	* src/gtk/ogra2cairo.c (gra2cairo_antialias_type)
	(gra2cairo_set_antialias, set_antialias): add.
	(gra2cairo_output, gra2cairo_init): add antialias settings.
	(gra2cairo): add member "antialias", "dpix" and "dpiy".
	(mxp2dw, mxd2pw, mxp2dh, mxd2ph, mxd2px, mxd2py): add.
	(gra2cairo_init, gra2cairo_set_dpi): add settings for pixel_dot_x
	and pixel_dot_y.
	(gra2cairo_set_dpi_x, gra2cairo_set_dpi_y): add.
	(draw_str, gra2cairo_output): use mxp2dw(), mxd2pw(), mxp2dh(),
	mxd2ph(), mxd2px() and mxd2py().

	* src/gtk/ogra2cairo.h (struct gra2cairo_local): add antialias,
	pixel_dot_x and pixel_dot_y.

2008-07-01  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (create_image_outputmenu): add.
	(create_outputmenu): add "Export image" sub menu.

	* src/gtk/x11menu.h (enum MenuID): add MenuId MenuIdOutputPSFile,
	MenuIdOutputEPSFile, MenuIdOutputPDFFile, MenuIdOutputPNGFile and
	MenuIdOutputSVGFile.

	* src/gtk/x11print.c (OutputImageDialogSetupItem)
	(OutputImageDialogSetup, OutputImageDialogClose)
	(OutputImageDialog, CmOutputImage): add.
	(CmOutputMenu): add case MenuIdOutputPSFile, MenuIdOutputEPSFile,
	MenuIdOutputPDFFile, MenuIdOutputPNGFile and MenuIdOutputSVGFile.


2008-06-30  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (MARK_PIX_SIZE): change mark pix size.

	* src/gra.c (GRAmark): fix size of triangle.

	* src/gtk/ox11menu.c: remove mxsaveGC() and mxrestoreGC().

	* src/gtk/x11file.c (draw_type_pixbuf): use gra2gdk.

	* src/gtk/x11lgndx.c (LegendGaussDialogPaint): use gra2gdk.

	* src/gtk/x11menu.c (create_markpixmap): use gra2gdk.
	(find_gra2gdk_inst): add.

	* src/gtk/x11view.c (ViewerWinSetup): call OpenGRA() after
	OpenGC().

	* src/gtk/Makefile.am (libngraph_la_SOURCES): add ogra2cairo.c,
	ogra2cairo.h, ogra2cairofile.c, ogra2x11.h, ogra2gdk.c and
	ogra2gdk.h

2008-06-27  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ogra2x11.c (gtkinit): gtkclose() is now called when
	"delete-event" signal is emitted.
	object 'gra2gtk' is now child of 'gra2cairo'.

2008-06-25  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/ogra2cairofile.c: add.

	* src/gtk/ogra2cairo.c: add.

2008-06-22  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11merge.c: remove ev_key_down().
	(CmMergeWindow): remove setting for d->ev_key.

	* src/gtk/x11axis.c: remove ev_key_down().
	(CmAxisWindow): remove setting for d->ev_key.

	* src/gtk/strconv.c (ascii2greece): bug fix: dlen must be "slen *
	2 + 1".
	(str2utf8): bug fix: dlen must be "slen * 6 + 1".

	* src/gtk/ogra2x11.c (gtk_charwidth, gtk_charheight): save and
	restore fontdir, fontsin and fontcos and set fontdir as 0 before
	call draw_str().

	* src/gtk/gtk_subwin.c (ev_key_down): add case for "GDK_SPACE"

	* src/gtk/gtk_liststore.c (create_tree_view): bug fix: add braces
	as "(n + cnum)" in argument of malloc.

2008-06-19  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11menu.c (detach_toolbar, create_toolbar): add.
	(setupwindow): use create_toolbar().

	* src/gtk/x11view.c (reorder_object): add.
	(ViewTop, ViewLast): use reorder_object().
	(ViewCopyAxis): add.
	(ViewCopy): use ViewCopyAxis().

2008-06-18  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11commn.c (ProgressDialogCreate): set cursor to GDK_WATCH.
	(ProgressDialogFinalize): restore cursor.

	* src/gtk/x11menu.c (GetCursor): add.

	* src/gtk/x11merge.c (ev_key_down): add.

	* src/gtk/x11view.c (Focus): now merge object can be focused.

2008-06-17  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (mouse_down_move_data)
	(mouse_down_set_points, mouse_down_zoom): add.
	(ViewerEvLButtonDown): use mouse_down_move_data(),
	mouse_down_set_points() and mouse_down_zoom().
	(ViewerEvRButtonDown): use mouse_down_zoom();
	(ViewerEvRButtonDown): cancel make arc, rectangle, gauss and axis
	when Button3 is pressed.
	(create_axis, create_single_axis, create_legendx)
	(create_legend3, create_legend2, create_legend1): add.
	(ViewerEvLButtonDblClk): use create_axis(), create_single_axis(),
	create_legendx(), create_legend3(), create_legend2() and
	create_legend1().
	(clear_focus_obj, UnFocus): add argument "int init_cursor".

2008-06-16  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (add_focus_obj, clear_focus_obj)
	(mouse_down_point, mouse_down_move, mouse_up_point)
	(set_mouse_cursor_hover, mouse_up_drag, mouse_up_zoom)
	(mouse_up_change, mouse_up_lgend1, mouse_up_lgend2): add.
	(Match, Focus): use add_focus_obj();
	(ViewerWinUpdate, UnFocus, ViewUpdate): use clear_focus_obj();
	(ViewerEvLButtonUp): use mouse_down_point(), mouse_up_drag(),
	mouse_up_zoom() and mouse_up_change().

	* src/gtk/x11menu.c (Command2_data): add move tool button.
	(createcommand2): default sensitivity of the MoveButton is false.
	(SetMoveButtonState): add.
	(SetCursor): add GDK_FLEUR.

	* src/gtk/x11view.c (enum ViewerPopupIdn): add alignment id.
	(struct viewer_popup): add member 'struct viewer_popup *submenu'
	(create_menu): add.
	(create_popup_menu): add alignment submenu. use create_menu.
	(AlignFocusedObj): add.
	(do_popup): add codes for alignment submenu.
	(check_focused_obj): add.
	(Focus): add argument "int add". add codes for multiple focus.
	(ViewerPopupMenu): call AlignFocusedObj().

	* src/gtk/x11axis.c (ev_key_down): check 'e->state &
	GDK_SHIFT_MASK' when e->keyval == GDK_space.

	* src/gtk/gtk_subwin.c (focus, tree_focus): add argument "int
	add".
	(ev_key_down_tree): check 'e->state & GDK_SHIFT_MASK' when
	e->keyval == GDK_space.
	(list_sub_window_add_focus, tree_sub_window_add_focus): add.

2008-06-13  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11lgnd.c (legend_dialog_close)
	(legend_dialog_setup_item, LegendRectDialogSetup): use width and
	height instaed of x2 and y2 for legend rectangle.

	* src/gtk/x11view.c (swapint): add.
	(ViewerEvLButtonDblClk): x2 and y2 are always greater than x1 and
	y2 respectivery.

2008-06-12  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (EvalDialogSetup): now "X" and "Y" is string.
	(EvalDialogSetupItem): add string converted from double.

	* src/gtk/x11file.c (FileMoveDialogClose): x and y is converted
	from string to double.
	(FileMoveDialogSetup): now "X" and "Y" is string.
	(FileMoveDialogAdd): add string converted from double.

	* src/omerge.c (mergeinit): initialize "line_num".

	* src/ogra.c (set_progress_val): add.
	(oGRAdraw): use set_progress_val().
	(oGRAdrawparent): call set_progress_val().

	* src/omerge.c (mergeredraw): check redraw_num.

	* src/gra.c (_GRAredraw): set "redraw_flag" as FALSE when redrawf
	is zero.
	(GRAredraw2, GRAredraw, _GRAredraw): replace redrawf to redraw_num.

	* src/omerge.c (merge): add "line_num"

	* src/oaxis.c (axisautoscalefile): display "group" property when
	the property is not NULL.

	* src/gtk/x11axis.c (axis_list_set_val): get "group" instead of "name".

	* src/gtk/ox11menu.c (mx_redraw): remove set_draw_lock().

	* src/gtk/x11view.c (AddInvalidateRect, Match): remove set_draw_lock().

	* src/gtk/x11menu.c (ChkInterrupt): do gtk_main_iteration_do() only
	when DrawLock == DrawLockDraw.

	* src/gtk/ox11menu.c (mx_output): bug fix: add 360 to
	Mxlocal->fontdir when Mxlocal->fontdir is negative.

	* configure.in: required version of GTK+ is greater than 2.12
	because gtk_tool_item_set_tooltip_text() is available since 2.12.


2008-06-10  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11commn.c (FreeConsole): restore ninterrupt.

	* driver/gra2wmf.c (draw, getboundingbox): bug fix: reported at
	http://www2e.biglobe.ne.jp/~isizaka/bbs_old/light.cgi [670].

	* src/gtk/ox11menu.c (mx_get_focused): add.
	(gtkmenu): add "focused".

	* src/gtk/x11dialg.c (CopyDialogSetup, SelectDialogSetup): select
	item if there is only one item.

	* src/gtk/x11view.c (Match, AddInvalidateRect): add
	set_draw_lock().

	* src/gtk/x11menu.c (save_hist): bug fix: remove redundant return.

	* src/gtk/x11opt.c (ViewerDialogSetupItem, ViewerDialogSetup)
	(ViewerDialogClose): add settings for "redraw_num".

	* src/gtk/ox11menu.c (menuinit): set "redraw_num".
	(mxredraw_num): add.
	(mx_redraw): check Mxlocal->redrawf_num.
	(mgtkloadconfig): get Mxlocal->redrawf_num from init file.
	(menuinit): initialize Mxlocal->redrawf_num.
	(gtkmenu): add "redraw_num"

	* src/odraw.c (draw): add "redraw_num".

	* src/gra.c (_GRAredraw): set "redraw_num".

	* src/ofile.c (f2dredraw): check "redraw_num".

	* src/gtk/x11commn.c (ProgressDialogFinalize)
	(ProgressDialogCreate): call set_draw_lock().

	* src/gtk/x11menu.c (ChkInterrupt): check DrawLock.
	(set_draw_lock): add.
	add DrawLock.

	* src/gtk/ox11menu.c (mx_redraw): call set_draw_lock().

	* src/gtk/x11commn.c: add ProgressBar2.

	* src/ogra.c (oGRAdraw): call set_progress().

	* src/gtk/x11print.c (CmOutputDriver, CmOutputViewer)
	(CmPrintGRAFile, CmPrintDataFile): call ProgressDialogCreate() and
	ProgressDialogFinalize().


2008-06-09  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/ofit.c (fituser): call set_progress() instead of
	ndisplaystatus().

	* src/ioutil.c add ShowProgressFunc, set_progress_func() and
	set_progress().

	* src/ofile.c add set_data_progress().
	(getdata): call set_data_progress().

	* src/gtk/x11menu.c (Command1_data): remove do_interrupt.
	(application): remove snooper_id, gtk_key_snooper_remove() and
	gtk_key_snooper_install().

	* src/gtk/x11commn.c add global variables ProgressBar and
	ProgressDiaog.  add ProgressDialogCreate(),
	ProgressDialogFinalize() and ProgressDialogSetTitle().

	* src/gtk/x11view.c (Draw): call ProgressDialogCreate(),
	ProgressDialogFinalize() and ProgressDialogSetTitle().

	* src/object.c (addobject): add alignment for 64bit architecture.


2008-06-08  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (ViewerWinFileUpdate): bug fix: reported at
	http://www2e.biglobe.ne.jp/~isizaka/bbs_old/light.cgi [802]-[805].
	(ViewerEvLButtonDown, ViewerEvRButtonDown): use nround() when
	change dpi.
	(ViewerEvScroll): bug fix: d->VScroll to d->HScroll.


2008-06-07  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/main.c (main): add g_set_application_name().

	* src/gtk/x11menu.c (application): remove
	g_set_application_name().

	* src/gtk/x11gui.c (FileSelectionDialog): call ResetEvent() after
	gtk_widget_destroy().


2008-06-04  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/shell.c (ngraphenvironment): add $NGRAPHHOME to PATH.

	* src/ofile.c (f2dsettings): ignore remark character placed at the
	top of the line.


2008-06-03  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11opt.c (DefaultDialogClose): add preserve_width.
	(MiscDialogSetupItem): add preserve_width.
	(MiscDialogSetup): add preserve_width.
	(MiscDialogClose): add preserve_width.
	(MiscDialogClose): add preserve_width.

	* src/gtk/ox11menu.c (mgtkloadconfig): add preserve_width.

	* src/gtk/x11view.c (ViewerEvLButtonUp): add preserve_width.

	* src/orect.c (rectzoom): add preserve_width.

	* src/omark.c (markzoom): add preserve_width.

	* src/olegend.c (legendzoom): add preserve_width.

	* src/oaxis.c (axiszoom2): add preserve_width.

	* src/oarc.c (arczoom): add preserve_width.

	* src/gtk/gtk_liststore.c (create_tree_view): add
	gtk_tree_view_column_set_resizable();

	* src/gtk/x11file.c (FileDialogSetup): check string by
	g_utf8_validate();

	* src/gtk/x11lgnd.c (legend_list_set_val): use g_utf8_strncpy()
	instead of strncpy().

2008-06-02  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11axis.c (AxisPosDialogSetupItem): add
	combo_box_clear(d->adjust).

	* src/gtk/ox11menu.c (mx_output): in the case 'V': remove
	Mxlocal->scrollx and Mxlocal->scrolly.
	(mx_output): in the case 'V': second argument must be mxd2py and
	third argument must be mxd2px.

	* src/gtk/x11view.c (MakeRuler): use mxd2p() instead of mxd2px()
	and mxd2y().

2008-05-30  Ito Hiroyuki  <ZXB01226 at nifty.com>

	* src/gtk/x11view.c (CloseGC): fix conditional
	expression ("Mxlocal->font[i].fontalias != NULL" to
	"Mxlocal->font[i].fontalias != NULL").

	* src/gtk/ox11menu.c (menudone): free Mxlocal->font[i].fontalias
	and Mxlocal->font[i].font only when Mxlocal->font[i].fontalias is
	not NULL.

	* src/gtk/gtk_subwin.c (sub_window_minimize): do nothing when a
	sub window is already iconified.

2008-05-27  gettextize  <bug-gnu-gettext@gnu.org>

	* Makefile.am (SUBDIRS): Add po, m4.
	(ACLOCAL_AMFLAGS): New variable.
	(EXTRA_DIST): Add config.rpath.

	* configure.in (AC_CONFIG_FILES): Add po/Makefile.in, m4/Makefile.

